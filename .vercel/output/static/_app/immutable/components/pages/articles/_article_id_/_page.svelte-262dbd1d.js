import{S as W,i as X,s as Y,e as O,b as p,B as b,h as u,a9 as ee,o as te,k,q as Z,l as g,m as v,r as $,D as T,E as q,u as x,n as D,a6 as z,aa as ie,ab as ne,I as le,U as E,f as _,t as m,d as V,T as P,w as C,a as j,x as J,c as B,y as A,g as N,z as M}from"../../../../chunks/index-8132481b.js";import{i as F,D as re}from"../../../../chunks/db_image-fcafce18.js";import{B as se}from"../../../../chunks/button-e8e119c3.js";import{a as ae}from"../../../../chunks/auth_state-7a238df3.js";import{a as S,u as H}from"../../../../chunks/articles-885999f7.js";import{b as oe,c as ce}from"../../../../chunks/datatypes-f51f27d5.js";import{m as fe}from"../../../../chunks/index-1d5742ea.js";import{i as L}from"../../../../chunks/loading_store-b28525d0.js";import{p as R}from"../../../../chunks/stores-88328872.js";import{g as ue}from"../../../../chunks/navigation-93d63568.js";function _e(a){let t,i,e,n;return{c(){t=k("div"),i=Z(a[0])},l(r){t=g(r,"DIV",{});var l=v(t);i=$(l,a[0]),l.forEach(u)},m(r,l){p(r,t,l),T(t,i),e||(n=q(t,"click",a[3]),e=!0)},p(r,l){l&1&&x(i,r[0])},d(r){r&&u(t),e=!1,n()}}}function de(a){let t,i,e,n;return{c(){t=k("form"),i=k("input"),this.h()},l(r){t=g(r,"FORM",{});var l=v(t);i=g(l,"INPUT",{class:!0}),l.forEach(u),this.h()},h(){i.required=a[1],D(i,"class","svelte-1lhsa3f")},m(r,l){p(r,t,l),T(t,i),z(i,a[0]),e||(n=[q(i,"input",a[6]),q(i,"blur",a[4]),ie(pe.call(null,i)),q(t,"submit",ne(a[4])),q(t,"keydown",a[5])],e=!0)},p(r,l){l&2&&(i.required=r[1]),l&1&&i.value!==r[0]&&z(i,r[0])},d(r){r&&u(t),e=!1,le(n)}}}function me(a){let t;function i(r,l){return r[2]?de:_e}let e=i(a),n=e(a);return{c(){n.c(),t=O()},l(r){n.l(r),t=O()},m(r,l){n.m(r,l),p(r,t,l)},p(r,[l]){e===(e=i(r))&&n?n.p(r,l):(n.d(1),n=e(r),n&&(n.c(),n.m(t.parentNode,t)))},i:b,o:b,d(r){n.d(r),r&&u(t)}}}function pe(a){a.focus()}function he(a,t,i){let{value:e}=t,{required:n=!0}=t;const r=ee();let l=!1,f;te(()=>{f=e});function s(){i(2,l=!0)}function o(){e!==f&&r("submit",e),i(2,l=!1)}function d(c){c.key=="Escape"&&(c.preventDefault(),i(0,e=f),i(2,l=!1))}function w(){e=this.value,i(0,e)}return a.$$set=c=>{"value"in c&&i(0,e=c.value),"required"in c&&i(1,n=c.required)},[e,n,l,s,o,d,w]}class be extends W{constructor(t){super(),X(this,t,he,me,Y,{value:0,required:1})}}async function ke(a){let t=E(S);if(a in t){const l=oe.safeParse(t[a]);if(l.success)return l.data}const i=await fetch("/api/get_article",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:a})});if(!i)return;const{item:e}=fe.object({item:ce}).parse(await i.json()),n={...e,image_link_id:e.image_link.id};t=E(S),t[a]=n,S.set(t);const r=E(F);return r[e.image_link.id]=e.image_link.image_url,F.set(r),n}async function ge(a){const t=await fetch("/api/update_article",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({article:a})});if(t.status!==200)throw new Error(await t.text());H.set(E(H)+1)}function G(a){var d,w;let t,i,e,n,r,l,f;i=new re({props:{id:(w=(d=a[2])==null?void 0:d.image_link_id)!=null?w:a[0],width:"300px"}});let s=a[1]!=="loading"&&K(a),o="content"in a[2]&&Q(a);return{c(){t=k("div"),C(i.$$.fragment),e=j(),n=k("div"),r=k("h1"),s&&s.c(),l=j(),o&&o.c(),this.h()},l(c){t=g(c,"DIV",{class:!0});var h=v(t);J(i.$$.fragment,h),h.forEach(u),e=B(c),n=g(c,"DIV",{class:!0});var y=v(n);r=g(y,"H1",{});var I=v(r);s&&s.l(I),I.forEach(u),l=B(y),o&&o.l(y),y.forEach(u),this.h()},h(){D(t,"class","image svelte-1xrakgo"),D(n,"class","article svelte-1xrakgo")},m(c,h){p(c,t,h),A(i,t,null),p(c,e,h),p(c,n,h),T(n,r),s&&s.m(r,null),T(n,l),o&&o.m(n,null),f=!0},p(c,h){var I,U;const y={};h&5&&(y.id=(U=(I=c[2])==null?void 0:I.image_link_id)!=null?U:c[0]),i.$set(y),c[1]!=="loading"?s?(s.p(c,h),h&2&&_(s,1)):(s=K(c),s.c(),_(s,1),s.m(r,null)):s&&(N(),m(s,1,1,()=>{s=null}),V()),"content"in c[2]?o?(o.p(c,h),h&4&&_(o,1)):(o=Q(c),o.c(),_(o,1),o.m(n,null)):o&&(N(),m(o,1,1,()=>{o=null}),V())},i(c){f||(_(i.$$.fragment,c),_(s),_(o),f=!0)},o(c){m(i.$$.fragment,c),m(s),m(o),f=!1},d(c){c&&u(t),M(i),c&&u(e),c&&u(n),s&&s.d(),o&&o.d()}}}function K(a){let t,i,e,n;const r=[ye,ve],l=[];function f(s,o){return s[3]?0:1}return t=f(a),i=l[t]=r[t](a),{c(){i.c(),e=O()},l(s){i.l(s),e=O()},m(s,o){l[t].m(s,o),p(s,e,o),n=!0},p(s,o){let d=t;t=f(s),t===d?l[t].p(s,o):(N(),m(l[d],1,1,()=>{l[d]=null}),V(),i=l[t],i?i.p(s,o):(i=l[t]=r[t](s),i.c()),_(i,1),i.m(e.parentNode,e))},i(s){n||(_(i),n=!0)},o(s){m(i),n=!1},d(s){l[t].d(s),s&&u(e)}}}function ve(a){let t=a[2].title+"",i;return{c(){i=Z(t)},l(e){i=$(e,t)},m(e,n){p(e,i,n)},p(e,n){n&4&&t!==(t=e[2].title+"")&&x(i,t)},i:b,o:b,d(e){e&&u(i)}}}function ye(a){let t,i;return t=new be({props:{value:a[2].title}}),t.$on("submit",a[6]),{c(){C(t.$$.fragment)},l(e){J(t.$$.fragment,e)},m(e,n){A(t,e,n),i=!0},p(e,n){const r={};n&4&&(r.value=e[2].title),t.$set(r)},i(e){i||(_(t.$$.fragment,e),i=!0)},o(e){m(t.$$.fragment,e),i=!1},d(e){M(t,e)}}}function Q(a){let t,i,e,n;const r=[Ee,we],l=[];function f(s,o){return s[3]?0:1}return i=f(a),e=l[i]=r[i](a),{c(){t=k("div"),e.c()},l(s){t=g(s,"DIV",{});var o=v(t);e.l(o),o.forEach(u)},m(s,o){p(s,t,o),l[i].m(t,null),n=!0},p(s,o){let d=i;i=f(s),i===d?l[i].p(s,o):(N(),m(l[d],1,1,()=>{l[d]=null}),V(),e=l[i],e?e.p(s,o):(e=l[i]=r[i](s),e.c()),_(e,1),e.m(t,null))},i(s){n||(_(e),n=!0)},o(s){m(e),n=!1},d(s){s&&u(t),l[i].d()}}}function we(a){return{c:b,l:b,m:b,p:b,i:b,o:b,d:b}}function Ee(a){let t,i,e,n,r;return n=new se({props:{text:"Speichern",onclick:a[7]}}),{c(){t=k("div"),i=j(),e=k("div"),C(n.$$.fragment),this.h()},l(l){t=g(l,"DIV",{class:!0});var f=v(t);f.forEach(u),i=B(l),e=g(l,"DIV",{class:!0});var s=v(e);J(n.$$.fragment,s),s.forEach(u),this.h()},h(){D(t,"class","editor svelte-1xrakgo"),D(e,"class","save_button svelte-1xrakgo")},m(l,f){p(l,t,f),p(l,i,f),p(l,e,f),A(n,e,null),r=!0},p(l,f){const s={};f&4&&(s.onclick=l[7]),n.$set(s)},i(l){r||(_(n.$$.fragment,l),r=!0)},o(l){m(n.$$.fragment,l),r=!1},d(l){l&&u(t),l&&u(i),l&&u(e),M(n)}}}function De(a){let t,i,e=a[2]&&G(a);return{c(){t=k("div"),e&&e.c(),this.h()},l(n){t=g(n,"DIV",{class:!0});var r=v(t);e&&e.l(r),r.forEach(u),this.h()},h(){D(t,"class","outer svelte-1xrakgo")},m(n,r){p(n,t,r),e&&e.m(t,null),i=!0},p(n,[r]){n[2]?e?(e.p(n,r),r&4&&_(e,1)):(e=G(n),e.c(),_(e,1),e.m(t,null)):e&&(N(),m(e,1,1,()=>{e=null}),V())},i(n){i||(_(e),i=!0)},o(n){m(e),i=!1},d(n){n&&u(t),e&&e.d()}}}function Ie(a,t,i){let e,n,r;P(a,S,c=>i(4,e=c)),P(a,R,c=>i(5,n=c)),P(a,ae,c=>i(3,r=c));let l=E(R).params.article_id,f="loading";async function s(c){c&&(i(1,f=await ke(c)?"loaded":"not_found"),f==="not_found"&&i(2,o={content:"",id:c,image_link_id:c,title:"Leerer Artikel",createdAt:JSON.stringify(new Date)}))}let o;const d=({detail:c})=>{if(!(o!=null&&o.title))throw new Error("article has no title, but title is shown");i(2,o.title=c,o)},w=async()=>{if(o===void 0)throw new Error("article_obj became undefined during save");if(!("content"in o))throw new Error("article has no content, but content is shown");ge(o),await ue("/blog")};return a.$$.update=()=>{a.$$.dirty&32&&i(0,l=n.params.article_id),a.$$.dirty&1&&(i(1,f="loading"),E(S)[l]||L.set(!0),s(l),L.set(!1),i(1,f=void 0)),a.$$.dirty&17&&i(2,o=e==null?void 0:e[l])},[l,f,o,r,e,n,d,w]}class Je extends W{constructor(t){super(),X(this,t,Ie,De,Y,{})}}export{Je as default};
